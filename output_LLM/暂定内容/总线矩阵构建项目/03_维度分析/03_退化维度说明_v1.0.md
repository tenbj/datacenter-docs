# 退化维度说明	

> **文档版本**: v1.0	
> **创建日期**: 2026-01-15	
> **依赖文件**: `02_维度属性明细表_v1.0.md`	

---

## 1. 退化维度概念	

### 1.1 什么是退化维度	

**退化维度（Degenerate Dimension）** 是指那些没有必要单独建立维度表，而直接保留在事实表中的维度属性。	

这类维度通常具有以下特征：	
1. **没有额外属性**：除了编号本身，没有其他需要分析的描述性属性	
2. **一一对应**：与事实表行一一对应，无法进行维度聚合	
3. **业务标识**：主要用于唯一标识业务事件，便于追溯和关联	

### 1.2 退化维度 vs 普通维度	

| 对比项 | 普通维度 | 退化维度 |	
|--------|----------|----------|	
| **存储位置** | 独立维度表 | 直接存放于事实表 |	
| **属性数量** | 多个描述性属性 | 仅有编号本身 |	
| **聚合能力** | 可按维度属性聚合 | 无法按编号聚合（无意义） |	
| **典型场景** | 产品、店铺、时间 | 订单号、物流单号、发票号 |	

---

## 2. 退化维度清单	

### 2.1 按数据域分类的退化维度	

<table>
    <thead>
        <tr>
            <th>编号</th>
            <th>数据域</th>
            <th>序号</th>
            <th>退化维度名称</th>
            <th>字段名</th>
            <th>数据类型</th>
            <th>所在事实表</th>
            <th>用途说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td rowspan="4">一</td>
            <td rowspan="4">交易域</td>
            <td>1</td>
            <td>订单号</td>
            <td>order_id</td>
            <td>VARCHAR(50)</td>
            <td>fct_trd_order</td>
            <td>订单唯一标识，用于关联和追溯</td>
        </tr>
        <tr>
            <td>2</td>
            <td>订单明细行号</td>
            <td>order_line_no</td>
            <td>INT</td>
            <td>fct_trd_order_detail</td>
            <td>订单明细行唯一标识</td>
        </tr>
        <tr>
            <td>3</td>
            <td>支付流水号</td>
            <td>payment_id</td>
            <td>VARCHAR(50)</td>
            <td>fct_trd_payment</td>
            <td>支付交易唯一标识</td>
        </tr>
        <tr>
            <td>4</td>
            <td>结算ID</td>
            <td>settlement_id</td>
            <td>VARCHAR(50)</td>
            <td>fct_trd_settlement</td>
            <td>平台结算唯一标识</td>
        </tr>
        <tr>
            <td rowspan="2">二</td>
            <td rowspan="2">库存域</td>
            <td>5</td>
            <td>入库单号</td>
            <td>stock_in_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_inv_stock_in</td>
            <td>入库单据唯一标识</td>
        </tr>
        <tr>
            <td>6</td>
            <td>出库单号</td>
            <td>stock_out_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_inv_stock_out</td>
            <td>出库单据唯一标识</td>
        </tr>
        <tr>
            <td rowspan="3">三</td>
            <td rowspan="3">履约域</td>
            <td>7</td>
            <td>物流单号</td>
            <td>tracking_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_fl_shipment</td>
            <td>物流追踪唯一标识</td>
        </tr>
        <tr>
            <td>8</td>
            <td>退货单号</td>
            <td>return_order_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_fl_return</td>
            <td>退货申请唯一标识</td>
        </tr>
        <tr>
            <td>9</td>
            <td>FBA Shipment ID</td>
            <td>fba_shipment_id</td>
            <td>VARCHAR(30)</td>
            <td>fct_fl_fba_inbound</td>
            <td>FBA入仓计划唯一标识</td>
        </tr>
        <tr>
            <td rowspan="2">四</td>
            <td rowspan="2">促销域</td>
            <td>10</td>
            <td>促销活动ID</td>
            <td>promotion_id</td>
            <td>VARCHAR(50)</td>
            <td>fct_prm_promotion</td>
            <td>促销活动唯一标识</td>
        </tr>
        <tr>
            <td>11</td>
            <td>优惠券码</td>
            <td>coupon_code</td>
            <td>VARCHAR(20)</td>
            <td>fct_prm_coupon_usage</td>
            <td>优惠券唯一标识</td>
        </tr>
        <tr>
            <td rowspan="2">五</td>
            <td rowspan="2">广告域</td>
            <td>12</td>
            <td>广告活动ID</td>
            <td>campaign_id</td>
            <td>VARCHAR(50)</td>
            <td>fct_ads_campaign</td>
            <td>广告活动唯一标识</td>
        </tr>
        <tr>
            <td>13</td>
            <td>广告组ID</td>
            <td>ad_group_id</td>
            <td>VARCHAR(50)</td>
            <td>fct_ads_ad_group</td>
            <td>广告组唯一标识</td>
        </tr>
        <tr>
            <td rowspan="2">六</td>
            <td rowspan="2">供采域</td>
            <td>14</td>
            <td>采购订单号</td>
            <td>po_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_sup_purchase_order</td>
            <td>采购订单唯一标识</td>
        </tr>
        <tr>
            <td>15</td>
            <td>采购申请号</td>
            <td>pr_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_sup_purchase_request</td>
            <td>采购申请唯一标识</td>
        </tr>
        <tr>
            <td rowspan="2">七</td>
            <td rowspan="2">生产域</td>
            <td>16</td>
            <td>生产工单号</td>
            <td>work_order_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_mfg_work_order</td>
            <td>生产工单唯一标识</td>
        </tr>
        <tr>
            <td>17</td>
            <td>生产批次号</td>
            <td>batch_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_mfg_production</td>
            <td>生产批次唯一标识</td>
        </tr>
        <tr>
            <td>八</td>
            <td>品控域</td>
            <td>18</td>
            <td>检验单号</td>
            <td>inspection_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_qc_inspection</td>
            <td>质检单据唯一标识</td>
        </tr>
        <tr>
            <td>九</td>
            <td>客服域</td>
            <td>19</td>
            <td>工单号</td>
            <td>ticket_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_cs_ticket</td>
            <td>客服工单唯一标识</td>
        </tr>
        <tr>
            <td>十</td>
            <td>财务域</td>
            <td>20</td>
            <td>凭证号</td>
            <td>voucher_no</td>
            <td>VARCHAR(50)</td>
            <td>fct_fin_voucher</td>
            <td>财务凭证唯一标识</td>
        </tr>
    </tbody>
</table>

---

## 3. 退化维度处理策略	

### 3.1 设计原则	

| 原则 | 说明 | 示例 |	
|------|------|------|	
| **保留业务编号** | 将业务编号作为事实表字段保留 | order_id 存放在订单事实表 |	
| **不建独立维度表** | 不为这些编号创建单独的维度表 | 不创建 dim_order |	
| **可作为关联键** | 可用于事实表之间的关联查询 | 通过 order_id 关联订单和退货 |	
| **建立索引** | 对退化维度字段建立索引以提升查询性能 | 在 order_id 上创建索引 |	

### 3.2 特殊处理场景	

#### 场景一：需要扩展属性	

如果未来某个退化维度需要增加描述属性，可以考虑升级为普通维度。	

**示例**：促销活动ID	
- **当前状态**：作为退化维度存放于事实表	
- **未来扩展**：如需记录活动名称、活动类型、活动时间等属性	
- **处理方式**：升级为独立维度表 `dim_prm_promotion`	

```sql	
-- 升级前：退化维度
SELECT promotion_id, SUM(sales_amount)
FROM fct_prm_promotion_sales
GROUP BY promotion_id;

-- 升级后：维度表关联
SELECT p.promotion_name, SUM(f.sales_amount)
FROM fct_prm_promotion_sales f
JOIN dim_prm_promotion p ON f.promotion_key = p.promotion_key
GROUP BY p.promotion_name;
```	

#### 场景二：作为事实表关联键	

退化维度可用于跨事实表关联分析。	

**示例**：通过订单号关联订单与退货	

```sql	
-- 订单与退货关联分析
SELECT 
    o.order_id,
    o.order_amount,
    r.return_amount,
    r.return_reason
FROM fct_trd_order o
LEFT JOIN fct_fl_return r ON o.order_id = r.order_id;
```	

---

## 4. 退化维度 vs 维度表决策矩阵	

用于判断某个业务标识应该作为退化维度还是独立维度表：	

| 判断条件 | 退化维度 | 独立维度表 |	
|----------|---------|-----------|	
| **属性数量** | 只有编号，无其他属性 | 有多个描述性属性 |	
| **聚合需求** | 无需按此维度聚合分析 | 需要按维度分组统计 |	
| **层级关系** | 无层级结构 | 存在层级（如类目） |	
| **共享程度** | 仅在单一事实表中使用 | 被多个事实表共享 |	
| **变化频率** | 一次生成后不再变化 | 属性可能随时间变化（SCD） |	

---

## 5. 退化维度汇总统计	

| 数据域 | 退化维度数 | 主要场景 |	
|--------|-----------|----------|	
| 交易域 | 4 | 订单号、支付流水号 |	
| 库存域 | 2 | 入出库单号 |	
| 履约域 | 3 | 物流单号、FBA ID |	
| 促销域 | 2 | 促销活动ID、优惠券码 |	
| 广告域 | 2 | 广告活动/组ID |	
| 供采域 | 2 | 采购订单/申请号 |	
| 生产域 | 2 | 工单号、批次号 |	
| 品控域 | 1 | 检验单号 |	
| 客服域 | 1 | 工单号 |	
| 财务域 | 1 | 凭证号 |	
| **合计** | **20** | - |	

---

## 6. 最佳实践建议	

### 6.1 命名规范	

退化维度字段命名建议：	
- 使用 `_id`、`_no`、`_code` 后缀表明其为标识符	
- 示例：`order_id`、`tracking_no`、`voucher_no`	

### 6.2 索引策略	

```sql	
-- 为高频查询的退化维度创建索引
CREATE INDEX idx_order_id ON fct_trd_order(order_id);
CREATE INDEX idx_tracking_no ON fct_fl_shipment(tracking_no);
```	

### 6.3 数据质量	

- 确保退化维度字段的唯一性和非空约束	
- 建立数据质量规则监控退化维度的完整性	

---

## 更新记录	

| 日期 | 版本 | 更新内容 | 更新人 |	
|------|------|----------|--------|	
| 2026-01-15 | v1.0 | 初始版本，识别20个退化维度 | AI架构师 |	
