# 履约域完整梳理文档	

> **数据域**: 履约域 (fl)	
> **优先级**: P1（重要域）	
> **版本**: v2.1	
> **创建日期**: 2026-01-19	
> **更新日期**: 2026-01-20	
> **负责人**: 王苗苗	
> **分析部门**: 流通分析	

---

## 1. 域定义与业务全景	

### 1.1 域定义	

履约域覆盖订单从发货到签收的**物流运输全过程**，包括正向物流（头程运输+尾程配送）和逆向物流（退换货处理）。其核心职责是**物流过程跟踪**，而非库存状态管理。	

### 1.2 物流网络结构	

```
物流网络
├── 头程运输（国内→海外）
│   ├── 国内仓 → 海外仓（自有）
│   └── 国内仓 → FBA仓（亚马逊托管）
├── 仓间调拨
│   └── 海外仓 → FBA仓
└── 尾程配送（仓库→买家）
    ├── 国内仓直发 → 买家（自发货）
    ├── 海外仓发货 → 买家（自有海外仓发货）
    └── FBA代发货 → 买家（亚马逊配送）
```

### 1.3 业务范围	

```
履约域核心：货物从卖家仓库到买家的运输过程
├── 头程物流（仓库到仓库）
│   ├── 海运头程：国内仓 → 海外仓/FBA仓
│   ├── 空运头程：国内仓 → 海外仓/FBA仓
│   └── 快递头程：国内仓 → 海外仓/FBA仓
├── 尾程物流（仓库到买家）
│   ├── 国内直发：国内仓 → 买家（跨境配送）
│   ├── 海外仓发货：海外仓 → 买家（本地配送）
│   └── FBA代发货：FBA仓 → 买家（亚马逊配送）
└── 逆向物流（买家到仓库）
    ├── 退货：买家退回商品 → 海外仓/FBA仓
    └── 换货：换发新商品
```

### 1.4 与库存域的边界澄清	

| 业务事件 | 履约域职责 | 库存域职责 |
|----------|-----------|-----------|
| 头程运输（国内仓→海外仓） | 跟踪运输状态（在途、到港、清关、签收） | 记录出库（国内仓）→入库（海外仓） |
| 头程运输（国内仓→FBA仓） | 跟踪运输状态（在途、到港、清关、接收） | 记录出库（国内仓）→入库（FBA仓） |
| 尾程配送（国内仓→买家） | 跟踪配送状态（国际运输、清关、派送、签收） | 记录销售出库（国内仓） |
| 尾程配送（海外仓→买家） | 跟踪配送状态（派送、签收） | 记录销售出库（海外仓） |
| 尾程配送（FBA仓→买家） | 跟踪配送状态（亚马逊物流） | 记录销售出库（FBA仓） |
| 退货处理 | 跟踪退货物流、处理退款 | 记录入库（返仓） |

> **关键澄清**：履约域关注**运输过程**（时间、状态、物流商），库存域关注**库存变化**（数量、金额）。	

---

## 2. 业务流程图	

```mermaid
flowchart TB
    subgraph 头程["🚢 头程物流（国内→海外）"]
        direction TB
        A1[国内仓出库] --> B1{目的仓}
        B1 -->|海外仓| C1[头程运输-海外仓]
        B1 -->|FBA仓| C2[头程运输-FBA仓]
        C1 --> D1[海运/空运/快递]
        C2 --> D2[海运/空运/快递]
        D1 --> E1[到港清关]
        D2 --> E2[到港清关]
        E1 --> F1[海外仓签收]
        E2 --> F2[FBA入仓]
    end
    
    subgraph 尾程["📦 尾程物流（仓库→买家）"]
        direction TB
        G1[订单支付] --> H1{配送方式}
        H1 -->|国内直发| I1[国内仓发货]
        H1 -->|海外仓| I2[海外仓发货]
        H1 -->|FBA| I3[FBA代发货]
        I1 --> J1[跨境运输]
        I2 --> J2[本地配送]
        I3 --> J3[亚马逊配送]
        J1 --> K[买家签收]
        J2 --> K
        J3 --> K
    end
    
    subgraph 逆向["🔄 逆向物流"]
        direction TB
        K --> L{买家满意?}
        L -->|否| M{处理方式}
        M -->|退货| N[处理退货]
        M -->|换货| O[处理换货]
        N --> P[退货物流]
        P --> Q[返仓入库]
        O --> R[重新发货]
    end
    
    style C1 fill:#e3f2fd
    style C2 fill:#f3e5f5
    style I1 fill:#fff3e0
    style I2 fill:#e3f2fd
    style I3 fill:#f3e5f5
    style K fill:#c8e6c9
    style N fill:#ffcdd2
```

---

## 3. 业务过程定义	

### 3.1 业务流程→业务过程映射	

> **推导逻辑**：业务流程中的每个**可度量的关键物流事件节点**成为一个业务过程	

| 业务流程阶段 | 业务过程 | 英文名称 | 为什么是业务过程 |
|-------------|---------|----------|-----------------|
| 头程物流 | 头程运输 | first_mile | 头程是可跟踪的运输阶段，有明确的里程碑 |
| 尾程物流-发货 | 发货配送 | ship_order | 发货是一个可度量事件，记录物流单号、发货时间 |
| 尾程物流-签收 | 物流履约 | delivery | 累积快照，跟踪从发货到签收的全过程 |
| 逆向物流-退货 | 处理退货 | process_return | 退货是一个可度量事件，有退货原因、处理结果 |
| 逆向物流-换货 | 处理换货 | process_exchange | 换货是一个可度量事件，有换货原因、新发货单 |

### 3.2 业务过程详细定义	

<table>
    <thead>
        <tr>
            <th>序号</th>
            <th>业务过程</th>
            <th>英文名称</th>
            <th>描述</th>
            <th>事实表类型</th>
            <th>粒度声明</th>
            <th>主键组成</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>头程运输</td>
            <td>first_mile</td>
            <td>头程运输（国内仓→海外仓/FBA仓）</td>
            <td>累积快照</td>
            <td>每一行代表一个头程运输任务</td>
            <td>头程单号/ShipmentID</td>
        </tr>
        <tr>
            <td>2</td>
            <td>发货配送</td>
            <td>ship_order</td>
            <td>订单发货（含国内直发、海外仓发货、FBA代发货）</td>
            <td>事务事实</td>
            <td>每一行代表一个包裹的发货记录</td>
            <td>物流单号</td>
        </tr>
        <tr>
            <td>3</td>
            <td>物流履约</td>
            <td>delivery</td>
            <td>全程物流跟踪（发货→签收）</td>
            <td>累积快照</td>
            <td>每一行代表一个订单的履约全过程</td>
            <td>订单号</td>
        </tr>
        <tr>
            <td>4</td>
            <td>处理退货</td>
            <td>process_return</td>
            <td>处理买家退货申请</td>
            <td>事务事实</td>
            <td>每一行代表一笔退货申请记录</td>
            <td>退货单号</td>
        </tr>
        <tr>
            <td>5</td>
            <td>处理换货</td>
            <td>process_exchange</td>
            <td>处理买家换货申请</td>
            <td>事务事实</td>
            <td>每一行代表一笔换货申请记录</td>
            <td>换货单号</td>
        </tr>
    </tbody>
</table>

### 3.3 头程运输累积快照说明	

**头程运输里程碑**：
```
出库 → 揽收 → 运输 → 到港 → 清关 → 签收
  │       │       │       │       │       │
  ↓       ↓       ↓       ↓       ↓       ↓
出库时间 揽收时间 在途时间 到港时间 清关时间 签收时间
```

### 3.4 尾程配送累积快照说明	

**尾程配送里程碑**（按发货类型有差异）：

| 发货类型 | 里程碑节点 |
|---------|-----------|
| 国内直发 | 发货 → 国际运输 → 到港 → 清关 → 本地派送 → 签收 |
| 海外仓发货 | 发货 → 本地派送 → 签收 |
| FBA代发货 | 发货 → 亚马逊配送 → 签收 |

---

## 4. 维度设计	

### 4.1 维度推导逻辑	

| 分析问题 | 对应维度 | 维度类型 |
|----------|---------|----------|
| 什么时候发货/签收？ | 时间维度 | 公共维度 |
| 什么商品？ | 产品维度 | 公共维度 |
| 从哪个仓库发货？ | 仓库维度 | 公共维度 |
| 什么发货类型？ | 发货类型维度 | 专属维度 |
| 用什么物流渠道？ | 物流渠道维度 | 专属维度 |
| 当前物流状态？ | 物流状态维度 | 专属维度 |
| 使用哪家物流商？ | 物流商维度 | 专属维度 |
| 为什么退货？ | 退货原因维度 | 专属维度 |
| 为什么换货？ | 换货原因维度 | 专属维度 |

### 4.2 维度清单	

#### 公共维度	

| 维度 | 英文名称 | 使用场景 |
|------|----------|----------|
| ✓ 时间维度 | dim_date | 所有业务过程 |
| ✓ 产品维度 | dim_product | 发货、退换货 |
| ✓ 仓库维度 | dim_warehouse | 发货、头程运输 |

#### 专属维度	

| 编号 | 维度名称 | 英文名称 | 主键 | 说明 |
|------|----------|----------|------|------|
| DIM-24 | 发货类型维度 | dim_ship_type | ship_type_key | 国内直发、海外仓发货、FBA代发货 |
| DIM-25 | 物流渠道维度 | dim_logistics_channel | channel_key | 头程（海运/空运/快递）、尾程（本地快递/亚马逊物流） |
| DIM-26 | 物流状态维度 | dim_shipment_status | status_key | 已发货、运输中、已到港、清关中、派送中、已签收 |
| DIM-27 | 物流商维度 | dim_carrier | carrier_key | DHL、UPS、FedEx、亚马逊物流、本地快递公司 |
| DIM-28 | 退货原因维度 | dim_return_reason | reason_key | 质量问题、尺寸不符、不想要了、描述不符 |
| DIM-29 | 换货原因维度 | dim_exchange_reason | reason_key | 尺寸换货、颜色换货、商品损坏 |
| DIM-30 | 目的国维度 | dim_destination_country | country_key | 美国、英国、德国、日本等 |

---

## 5. 事实表设计	

### 5.1 事实表清单	

| 编号 | 事实表名称 | 英文表名 | 类型 | 更新频率 | 说明 |
|------|-----------|----------|------|----------|------|
| FCT-16 | 头程运输事实表 | fct_fl_first_mile | 累积快照 | 日 | 跟踪头程运输里程碑（含海外仓和FBA仓） |
| FCT-17 | 发货事实表 | fct_fl_shipment | 事务事实 | 日 | 记录每笔发货事件（含三种发货类型） |
| FCT-18 | 物流履约事实表 | fct_fl_delivery | 累积快照 | 日 | 跟踪订单从发货到签收全流程 |
| FCT-19 | 退货事实表 | fct_fl_return | 事务事实 | 日 | 记录退货事件 |
| FCT-20 | 换货事实表 | fct_fl_exchange | 事务事实 | 日 | 记录换货事件 |

### 5.2 度量指标	

| 指标名称 | 指标说明 | 聚合方式 | 来源事实表 |
|----------|----------|----------|-----------|
| 头程单数 | 头程运输任务数 | SUM | fct_fl_first_mile |
| 头程时效 | 头程运输平均天数 | AVG | fct_fl_first_mile |
| 头程运费 | 头程物流费用 | SUM | fct_fl_first_mile |
| 发货数量 | 发货包裹总数 | SUM | fct_fl_shipment |
| 国内直发数 | 国内直发包裹数 | SUM | fct_fl_shipment |
| 海外仓发货数 | 海外仓发货包裹数 | SUM | fct_fl_shipment |
| FBA发货数 | FBA代发货包裹数 | SUM | fct_fl_shipment |
| 运费 | 物流费用总额 | SUM | fct_fl_shipment |
| 履约时效 | 从发货到签收的平均天数 | AVG | fct_fl_delivery |
| 妥投率 | 成功签收的订单占比 | AVG | fct_fl_delivery |
| 退货数量 | 退货商品总数 | SUM | fct_fl_return |
| 退货率 | 退货订单占比 | AVG | fct_fl_return |
| 换货数量 | 换货商品总数 | SUM | fct_fl_exchange |

---

## 6. 总线矩阵	

### 6.1 履约域总线矩阵	

| 业务过程 | 时间 | 产品 | 仓库 | 发货类型 | 物流渠道 | 物流状态 | 物流商 | 目的国 | 退货原因 | 换货原因 |
|----------|------|------|------|----------|----------|----------|--------|--------|----------|----------|
| 头程运输 | ✓ | ✓ | ✓ | | ✓ | ✓ | ✓ | ✓ | | |
| 发货配送 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | | |
| 物流履约 | ✓ | | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | | |
| 处理退货 | ✓ | ✓ | ✓ | | | | | ✓ | ✓ | |
| 处理换货 | ✓ | ✓ | ✓ | | | | | ✓ | | ✓ |

### 6.2 总线矩阵解读	

- **发货类型维度**：核心分析维度，区分国内直发、海外仓发货、FBA代发货	
- **物流渠道维度**：区分头程（海运/空运/快递）和尾程（本地快递/亚马逊物流）	
- **目的国维度**：区分不同国家/市场的物流表现	
- **物流商维度**：分析不同物流商的时效和成本	

---

## 7. 跨域关联说明	

### 7.1 与库存域的关联	

| 履约域事件 | 关联库存域事件 | 关联方式 |
|-----------|---------------|----------|
| 头程发货 | 国内仓出库（头程补货） | 头程单号关联 |
| 头程签收（海外仓） | 海外仓入库 | 头程单号关联 |
| 头程签收（FBA仓） | FBA入仓 | ShipmentID关联 |
| 尾程发货（国内直发） | 国内仓销售出库 | 物流单号关联 |
| 尾程发货（海外仓） | 海外仓销售出库 | 物流单号关联 |
| 尾程发货（FBA） | FBA仓销售出库 | 订单号关联 |
| 处理退货完成 | 退货返仓入库 | 退货单号关联 |

### 7.2 与交易域的关联	

| 履约域事件 | 关联交易域事件 | 关联方式 |
|-----------|---------------|----------|
| 物流履约签收 | 订单完成 | 订单号关联 |
| 处理退货 | 订单退款 | 订单号关联 |
| 处理换货 | 新订单创建 | 原订单号关联 |

---

## 8. 发货类型对比	

| 发货类型 | 发货仓库 | 物流商 | 配送时效 | 物流成本 | 适用场景 |
|----------|---------|--------|----------|----------|----------|
| 国内直发 | 国内仓 | 跨境物流商 | 7-30天 | 中等 | 低频商品、测品 |
| 海外仓发货 | 海外仓(自有) | 本地物流商 | 2-5天 | 较高 | 中高频商品 |
| FBA代发货 | FBA仓(托管) | 亚马逊物流 | 1-3天 | 较高 | 高频商品、Prime |

---

## 更新记录	

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v2.0 | 2026-01-19 | 初始版本 |
| v2.1 | 2026-01-20 | 修正物流网络结构：区分国内仓、海外仓(自有)、FBA仓(托管)三类仓库的物流流程，新增发货类型维度、目的国维度 |
