# 事实表粒度定义	

> **文档版本**: v1.0	
> **创建日期**: 2026-01-15	
> **依赖文件**: `01_事实表类型规划_v1.0.md`	

---

## 1. 粒度定义概述	

### 1.1 粒度定义原则	

事实表粒度定义是数据仓库设计的关键步骤，需要回答：	
- **一行代表什么**：明确每行数据的业务含义	
- **主键是什么**：确定唯一标识这一行的字段组合	
- **关联哪些维度**：确定该事实表需要关联的维度表	

### 1.2 粒度级别分类	

| 粒度级别 | 说明 | 示例 |	
|----------|------|------|	
| 原子粒度 | 最细粒度，不可再拆分 | 订单明细行 |	
| 聚合粒度 | 按某维度聚合后的粒度 | 日汇总、月汇总 |	

---

## 2. P0级核心域事实表粒度	

### 2.1 交易域事实表粒度	

<table>
    <thead>
        <tr>
            <th>事实表</th>
            <th>粒度声明</th>
            <th>主键字段</th>
            <th>关联维度</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>fct_trd_order<br/>(订单事实表)</td>
            <td>每行代表一笔亚马逊订单</td>
            <td>order_id</td>
            <td>时间、店铺、站点</td>
        </tr>
        <tr>
            <td>fct_trd_order_detail<br/>(订单明细事实表)</td>
            <td>每行代表一笔订单中的一个商品明细</td>
            <td>order_id + order_line_no</td>
            <td>时间、店铺、产品、变体</td>
        </tr>
        <tr>
            <td>fct_trd_payment<br/>(支付事实表)</td>
            <td>每行代表一笔支付交易</td>
            <td>payment_id</td>
            <td>时间、店铺、支付方式</td>
        </tr>
        <tr>
            <td>fct_trd_settlement<br/>(结算事实表)</td>
            <td>每行代表一笔平台结算记录</td>
            <td>settlement_id + order_id</td>
            <td>时间、店铺、币种</td>
        </tr>
        <tr>
            <td>fct_trd_review<br/>(评价事实表)</td>
            <td>每行代表一条用户评价</td>
            <td>review_id</td>
            <td>时间、产品、评价等级</td>
        </tr>
        <tr>
            <td>fct_trd_order_fulfillment<br/>(订单履约累积快照)</td>
            <td>每行代表一笔订单的全生命周期</td>
            <td>order_id</td>
            <td>时间(多个)、产品、店铺</td>
        </tr>
    </tbody>
</table>

### 2.2 运营域事实表粒度	

<table>
    <thead>
        <tr>
            <th>事实表</th>
            <th>粒度声明</th>
            <th>主键字段</th>
            <th>关联维度</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>fct_op_listing<br/>(链接上架事实表)</td>
            <td>每行代表一个链接的上架事件</td>
            <td>asin + marketplace_id</td>
            <td>时间、产品、站点、链接状态</td>
        </tr>
        <tr>
            <td>fct_op_traffic_daily<br/>(流量日快照)</td>
            <td>每行代表某天某链接的流量数据</td>
            <td>asin + date_key</td>
            <td>时间、产品、店铺、站点</td>
        </tr>
        <tr>
            <td>fct_op_organic_daily<br/>(自然流量日快照)</td>
            <td>每行代表某天某链接某关键词的自然流量</td>
            <td>asin + keyword_id + date_key</td>
            <td>时间、产品、关键词</td>
        </tr>
    </tbody>
</table>

---

## 3. P1级重要域事实表粒度	

### 3.1 库存域事实表粒度	

<table>
    <thead>
        <tr>
            <th>事实表</th>
            <th>粒度声明</th>
            <th>主键字段</th>
            <th>关联维度</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>fct_inv_stock_in<br/>(入库事实表)</td>
            <td>每行代表一笔入库单明细</td>
            <td>stock_in_no + line_no</td>
            <td>时间、产品、仓库、供应商</td>
        </tr>
        <tr>
            <td>fct_inv_stock_out<br/>(出库事实表)</td>
            <td>每行代表一笔出库单明细</td>
            <td>stock_out_no + line_no</td>
            <td>时间、产品、仓库</td>
        </tr>
        <tr>
            <td>fct_inv_stock_daily<br/>(库存日快照)</td>
            <td>每行代表某天某仓库某SKU的库存余额</td>
            <td>warehouse_key + sku + date_key</td>
            <td>时间、产品、仓库、库存状态</td>
        </tr>
        <tr>
            <td>fct_inv_aging_daily<br/>(库龄日快照)</td>
            <td>每行代表某天某仓库某SKU某库龄段的数量</td>
            <td>warehouse_key + sku + age_bucket_key + date_key</td>
            <td>时间、产品、仓库、库龄区间</td>
        </tr>
    </tbody>
</table>

### 3.2 履约域事实表粒度	

<table>
    <thead>
        <tr>
            <th>事实表</th>
            <th>粒度声明</th>
            <th>主键字段</th>
            <th>关联维度</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>fct_fl_shipment<br/>(发货事实表)</td>
            <td>每行代表一个包裹的发货记录</td>
            <td>tracking_no</td>
            <td>时间、仓库、物流渠道</td>
        </tr>
        <tr>
            <td>fct_fl_fba_inbound<br/>(FBA入仓事实表)</td>
            <td>每行代表FBA入仓计划中的一个SKU</td>
            <td>fba_shipment_id + sku</td>
            <td>时间、产品、仓库</td>
        </tr>
        <tr>
            <td>fct_fl_return<br/>(退货事实表)</td>
            <td>每行代表一笔退货申请</td>
            <td>return_order_no</td>
            <td>时间、产品、退货原因</td>
        </tr>
        <tr>
            <td>fct_fl_delivery_snapshot<br/>(物流履约累积快照)</td>
            <td>每行代表一个包裹的物流全流程</td>
            <td>tracking_no</td>
            <td>时间(多个)、仓库、物流渠道</td>
        </tr>
    </tbody>
</table>

### 3.3 促销域事实表粒度	

<table>
    <thead>
        <tr>
            <th>事实表</th>
            <th>粒度声明</th>
            <th>主键字段</th>
            <th>关联维度</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>fct_prm_promotion<br/>(促销活动事实表)</td>
            <td>每行代表一个促销活动</td>
            <td>promotion_id</td>
            <td>时间、店铺、促销类型</td>
        </tr>
        <tr>
            <td>fct_prm_sales_daily<br/>(促销销售日快照)</td>
            <td>每行代表某天某促销活动某商品的销售</td>
            <td>promotion_id + asin + date_key</td>
            <td>时间、产品、促销类型</td>
        </tr>
        <tr>
            <td>fct_prm_cost<br/>(促销费用事实表)</td>
            <td>每行代表一笔促销费用支出</td>
            <td>promotion_id + cost_type</td>
            <td>时间、促销类型、费用类型</td>
        </tr>
    </tbody>
</table>

### 3.4 广告域事实表粒度	

<table>
    <thead>
        <tr>
            <th>事实表</th>
            <th>粒度声明</th>
            <th>主键字段</th>
            <th>关联维度</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>fct_ads_campaign<br/>(广告活动事实表)</td>
            <td>每行代表一个广告活动</td>
            <td>campaign_id</td>
            <td>时间、店铺、广告类型</td>
        </tr>
        <tr>
            <td>fct_ads_keyword<br/>(关键词投放事实表)</td>
            <td>每行代表一个广告组中的一个关键词</td>
            <td>campaign_id + ad_group_id + keyword_id</td>
            <td>关键词、匹配类型、广告目标</td>
        </tr>
        <tr>
            <td>fct_ads_performance_daily<br/>(广告效果日快照)</td>
            <td>每行代表某天某广告活动的效果数据</td>
            <td>campaign_id + date_key</td>
            <td>时间、广告类型、广告位</td>
        </tr>
        <tr>
            <td>fct_ads_keyword_daily<br/>(广告关键词日快照)</td>
            <td>每行代表某天某关键词的效果数据</td>
            <td>campaign_id + keyword_id + date_key</td>
            <td>时间、关键词、匹配类型</td>
        </tr>
    </tbody>
</table>

---

## 4. P2/P3级事实表粒度	

### 4.1 汇总表	

| 数据域 | 事实表 | 粒度声明 | 主键字段 |	
|--------|--------|----------|----------|	
| 研发域 | fct_rd_iteration | 每行代表一个产品迭代版本 | product_id + version |	
| 研发域 | fct_rd_bom_change | 每行代表一次BOM变更 | bom_version_id |	
| 供采域 | fct_sup_purchase_order | 每行代表一个采购订单明细 | po_no + line_no |	
| 供采域 | fct_sup_payment | 每行代表一笔采购付款 | payment_id |	
| 生产域 | fct_mfg_work_order | 每行代表一个生产工单 | work_order_no |	
| 生产域 | fct_mfg_capacity_daily | 每行代表某天某车间的产能 | workshop_id + date_key |	
| 生产域 | fct_mfg_oee_daily | 每行代表某天某设备的OEE | equipment_id + date_key |	
| 品控域 | fct_qc_iqc | 每行代表一批来料检验 | inspection_no |	
| 品控域 | fct_qc_ipqc | 每行代表一次过程检验 | inspection_no |	
| 品控域 | fct_qc_oqc | 每行代表一批成品检验 | inspection_no |	
| 市场域 | fct_mkt_listing_daily | 每行代表某天某链接的BSR数据 | asin + date_key |	
| 市场域 | fct_mkt_competitor_daily | 每行代表某天某竞品的监控数据 | competitor_asin + date_key |	
| 客服域 | fct_cs_complaint | 每行代表一次客诉 | complaint_id |	
| 客服域 | fct_cs_ticket | 每行代表一个客服工单 | ticket_no |	
| 财务域 | fct_fin_ar_ap | 每行代表一笔应收/应付 | voucher_no |	
| 财务域 | fct_fin_profit_monthly | 每行代表某月某店铺/产品的利润 | store_id + asin + month_key |	

---

## 5. 粒度统计与建议	

### 5.1 粒度级别分布	

| 粒度级别 | 事实表数 | 占比 | 典型场景 |	
|----------|----------|------|----------|	
| 订单/单据级 | 18 | 45% | 订单、入出库单、工单 |	
| 明细行级 | 8 | 20% | 订单明细、采购明细 |	
| 日级快照 | 12 | 30% | 流量、库存、广告效果 |	
| 月级快照 | 2 | 5% | 利润核算 |	

### 5.2 主键设计建议	

1. **使用代理键**：建议为每个事实表增加自增代理键以提升查询性能	
2. **复合主键**：对于明细级和快照级事实表，使用业务复合键确保唯一性	
3. **保留业务键**：退化维度（如订单号）作为业务关联键保留	

---

## 更新记录	

| 日期 | 版本 | 更新内容 | 更新人 |	
|------|------|----------|--------|	
| 2026-01-15 | v1.0 | 初始版本，为40个事实表定义粒度 | AI架构师 |	
