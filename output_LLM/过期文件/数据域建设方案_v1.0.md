# 数据域建设方案

**版本**: v1.0
**日期**: 2026-01-12
**状态**: 初稿

## 1. 建设背景与目标
结合《数据域定义表》、《应用场景》及《需求清单》，本文档旨在明确数据仓库的数据域建设范围，规范业务过程、事实表及维度定义，并建立需求与数据域的映射关系，以指导后续的数据模型设计与开发。

## 2. 数据域建设概览
根据权威资料，本项目共划分 **16 个标准数据域**，并根据业务紧迫性划分为 P0-P3 四个优先级。

| 优先级 | 数据域集合 | 建设重点 |
| :--- | :--- | :--- |
| **P0 (核心)** | **交易域 (trd)**, **运营域 (op)** | 解决最核心的订单交易与店铺流量运营分析，是所有分析的基础。 |
| **P1 (重要)** | **库存域 (inv)**, **履约域 (fl)**, **促销域 (prm)**, **广告域 (ads)** | 解决供应链流转、履约时效及营销推广效果，直接影响成本与增长。 |
| **P2 (一般)** | 研发域, 供采域, 生产域, 品控域 | 完善产品全生命周期与供应链上游管理。 |
| **P3 (辅助)** | 市场域, 客服域, 财务域, 客户域, 政策域, 算法域 | 支持更深度的市场洞察、财务核算及客户精细化运营。 |

---

## 3. 核心数据域建设详情 (P0 & P1)

### 3.1 交易域 (Trade Domain - trd)
*   **对应需求/场景**: 订单管理、销售毛利、业务概览（周期数据）、转化分析。
*   **业务过程**: 下单、支付、发货、确认收货、退款、交易取消。
*   **关键事实表**:
    *   `dwd_trd_order_detail_dd` (订单明细事务事实表)
    *   `dws_trd_sku_sales_1d` (SKU粒度日销售汇总)
    *   `dws_trd_shop_sales_1d` (店铺粒度日销售汇总)
*   **一致性维度**: 店铺 (`dim_shop`), 商品 (`dim_product`), 站点 (`dim_site`), 时间 (`dim_date`).

### 3.2 运营域 (Operation Domain - op)
*   **对应需求/场景**: 流量分析、账号健康、链接合规、全盘看板。
*   **业务过程**: 流量获取 (PV/UV)、ASIN表现监控、店铺绩效评估、Listing优化。
*   **关键事实表**:
    *   `dwd_op_traffic_source_dd` (流量来源明细)
    *   `dws_op_asin_performance_1d` (ASIN表现日汇总 - 流量/转化/排名)
    *   `dws_op_shop_performance_1d` (店铺绩效日汇总)
*   **一致性维度**: 店铺, 商品, 流量渠道 (`dim_channel`), 时间.

### 3.3 广告域 (Advertising Domain - ads)
*   **对应需求/场景**: 广告投放、广告复盘、关键词竞价、广告流量。
*   **业务过程**: 广告展示、广告点击、广告转化、广告费用结算。
*   **关键事实表**:
    *   `dwd_ads_campaign_report_dd` (广告活动报告明细)
    *   `dwd_ads_keyword_report_dd` (关键词投放报告明细)
    *   `dws_ads_placement_performance_1d` (广告位表现日汇总)
*   **一致性维度**: 广告活动 (`dim_campaign`), 广告组 (`dim_adgroup`), 关键词 (`dim_keyword`), 商品, 店铺, 时间.

### 3.4 库存域 (Inventory Domain - inv)
*   **对应需求/场景**: 库存管理、动销分析、补货建议、库容规划。
*   **业务过程**: 入库、出库、盘点、库龄计算、库存快照。
*   **关键事实表**:
    *   `dwd_inv_transaction_dd` (库存事务明细 - 入/出/盘)
    *   `dws_inv_sku_stock_1d` (SKU日库存快照 & 库龄)
    *   `dws_inv_fba_level_1d` (FBA库存水位监控)
*   **一致性维度**: 仓库 (`dim_warehouse`), 商品, 供应商 (`dim_supplier`), 时间.

### 3.5 履约域 (Fulfillment Domain - fl)
*   **对应需求/场景**: 订单履约、物流配送、头程物流。
*   **业务过程**: 订单拣货、打包、发货运输、签收、FBA配送。
*   **关键事实表**:
    *   `dwd_fl_shipment_detail_dd` (发货单明细)
    *   `dws_fl_logistics_efficiency_1d` (物流时效分析)
*   **一致性维度**: 物流商 (`dim_logistics_provider`), 仓库, 目的地, 时间.

### 3.6 促销域 (Promotion Domain - prm)
*   **对应需求/场景**: 促销活动、活动复盘、Deal效果。
*   **业务过程**: 促销发布、优惠券领取、促销核销。
*   **关键事实表**:
    *   `dwd_prm_promotion_record_dd` (促销活动记录)
    *   `dws_prm_event_roi_1d` (活动ROI分析)
*   **一致性维度**: 促销活动 (`dim_promotion`), 商品, 店铺, 时间.

---

## 4. 需求与数据域映射表
基于《需求匹配》与《应用场景》，将部分核心需求映射如下：

| 需求来源 | 需求模块/场景 | 核心业务指标/内容 | 归属数据域 | 涉及事实表 |
| :--- | :--- | :--- | :--- | :--- |
| 应用场景 | 选品分析 | 市场容量, 竞争程度 | 市场域 (mkt) | `dws_mkt_category_trend_1d` |
| 应用场景 | 流量分析 | 流量来源, 转化率 | 运营域 (op) | `dwd_op_traffic_source_dd` |
| 需求清单 | 活动促销效益 | 活动ROI, 销量拉动 | 促销域 (prm) | `dws_prm_event_roi_1d` |
| 需求清单 | 竞品站外推广 | 竞品流量, 推广渠道 | 市场域 (mkt) | `dwd_mkt_competitor_traffic_dd` |
| 需求清单 | FBA仓储 | 库龄, 周转天数 | 库存域 (inv) | `dws_inv_sku_stock_1d` |
| 需求清单 | 广告效益 | ACOS, ROAS, CPC | 广告域 (ads) | `dws_ads_placement_performance_1d` |
| 需求清单 | 销售净额 | GMV, 净销售额 | 交易域 (trd) | `dws_trd_shop_sales_1d` |
| 需求清单 | 客诉分析 | 退货率, 差评原因 | 客服域 (cs) | `dwd_cs_feedback_detail_dd` |
| 需求清单 | 利润核算 | 单品毛利, 净利润 | 财务域 (fin) | `dws_fin_sku_profit_1d` |

---

## 5. 总线矩阵 (Bus Matrix)

| 业务过程 \ 一致性维度 | 店铺 | 商品 (SKU) | 站点/市场 | 供应商 | 仓库 | 广告活动 | 客户 | 时间 |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **订单交易 (trd)** | √ | √ | √ | | | | √ | √ |
| **流量监控 (op)** | √ | √ | √ | | | | | √ |
| **广告投放 (ads)** | √ | √ | √ | | | √ | | √ |
| **采购入库 (sup/inv)** | | √ | | √ | √ | | | √ |
| **库存快照 (inv)** | | √ | | | √ | | | √ |
| **发货履约 (fl)** | √ | √ | √ | | √ | | √ | √ |
| **客户评价 (cs)** | √ | √ | | | | | √ | √ |

---

## 6. 增补建议与缺口分析

1.  **竞品数据缺失**:
    *   **现状**: 需求中包含大量“竞品分析”（如竞品销量、竞品广告），但目前数据域定义主要侧重内部数据。
    *   **建议**: 需在 **市场域 (mkt)** 中重点建设竞品采集与清洗流程，可能需要爬虫或第三方数据源（如H10, Keepa）对接。需新增 `ods_mkt_competitor_listing` 等外部数据表。

2.  **财务成本精细化**:
    *   **现状**: 需求涉及“单品利润测算”、“头程物流成本分摊”。
    *   **建议**: **财务域 (fin)** 需建立分摊模型，将广告费、仓储费、物流费精确分摊到 SKU 级别。需建设 `dwd_fin_cost_allocation_dd` 中间表。

3.  **用户行为数据**:
    *   **现状**: “客户画像”、“复购策略”在 P3，但“流量分析”在 P0/Scenarios 中很重要。
    *   **建议**: 虽然 **客户域 (cst)** 是 P3，但基础的 `dim_customer` (客户维度) 应在 **交易域** 建设时同步初始化，以便后续扩展。

4.  **目标管理**:
    *   **现状**: 应用场景中提到“目标管理 (Target Management)”。
    *   **建议**: 建议在 **运营域 (op)** 或单独的 **管理域** 中维护一张 `dim_target_config` (目标配置表)，用于存放各维度的预算/目标值，以便计算达成率。

## 7. 下一步行动
1.  确认 P0/P1 域的源系统数据接入情况（特别是广告与库存数据）。
2.  针对“竞品”数据，确定数据获取方案。
3.  开始设计 **交易域** 和 **运营域** 的详细模型（ODS -> DWD -> DWS）。
