# 库存域与履约域边界澄清说明	

> **版本**: v1.0	
> **创建日期**: 2026-01-19	
> **目的**: 澄清FBA入仓等跨域业务过程的归属问题	

---

## 1. 问题背景	

在原始设计中，**FBA入仓**被定义在履约域（序号19）。但在业务分析中发现，FBA入仓也具有库存属性（使FBA仓库存增加）。本文档不修改原始定义，而是**澄清其双重属性**。	

---

## 2. 原始定义（保持不变）	

### 履约域业务过程（权威定义）	

| 序号 | 业务过程 | 英文名称 | 归属域 |
|------|---------|----------|--------|
| 18 | 发货配送 | ship_order | 履约域 |
| **19** | **FBA入仓** | **fba_inbound** | **履约域** ✓ |
| 20 | 处理退货 | process_return | 履约域 |
| 21 | 处理换货 | process_exchange | 履约域 |

### 库存域业务过程（权威定义）	

| 序号 | 业务过程 | 英文名称 | 归属域 |
|------|---------|----------|--------|
| 13 | 商品入库 | stock_in | 库存域 |
| 14 | 商品出库 | stock_out | 库存域 |
| 15 | 库存盘点 | stock_check | 库存域 |
| 16 | 库龄分析 | inventory_aging | 库存域 |
| 17 | 库存损耗 | stock_loss | 库存域 |

---

## 3. FBA入仓的双重属性（澄清说明）	

### 3.1 为什么FBA入仓属于履约域？	

从**物流运输视角**：	
- FBA入仓是货物从国内仓通过头程运输到达亚马逊仓库的**物流事件**	
- 关注的是**运输过程**：发货时间、到达时间、运输状态、物流费用	
- 与发货配送同属一个物流链路	

```
国内仓 ──→ 头程运输 ──→ FBA仓（入仓签收）
  ↑                        ↑
出库事件                  FBA入仓事件（履约域）
（库存域）                
```

### 3.2 FBA入仓对库存域的影响	

从**库存状态视角**：	
- FBA入仓完成后，**FBA仓库存会增加**	
- 这个库存变化需要在库存域中被记录	
- 通过"仓库类型维度"区分自有仓和FBA仓	

### 3.3 正确的理解方式	

| 视角 | FBA入仓的含义 | 记录位置 |
|------|-------------|----------|
| 物流视角 | 头程运输的终点事件 | 履约域事实表 `fct_fl_fba_inbound` |
| 库存视角 | FBA仓的入库事件 | 库存域快照 `fct_inv_stock_daily`（FBA仓库存增加） |

### 3.4 关联关系	

```
履约域.FBA入仓 ──→ 触发 ──→ 库存域.FBA仓库存增加
     │                         │
     └─── ShipmentID 关联 ─────┘
```

---

## 4. 数据模型建议	

### 4.1 保持原始归属	

**FBA入仓事实表仍属于履约域**：	
- 表名：`fct_fl_fba_inbound`	
- 记录：入仓时间、ShipmentID、SKU、数量、物流状态	

### 4.2 库存域通过快照反映	

**库存域通过日快照记录FBA库存**：	
- 表名：`fct_inv_stock_daily`	
- 通过"仓库类型 = FBA仓"区分	
- 数据来源：从FBA入仓事实表累计计算	

### 4.3 推荐的维度设计	

| 维度 | 说明 | 使用场景 |
|------|------|----------|
| dim_warehouse_type | 区分自有仓/FBA仓 | 库存域所有事实表 |
| dim_inbound_type | 区分入库类型（采购/生产/FBA入仓/退货返仓） | 库存域入库分析 |

---

## 5. 结论	

### 5.1 官方归属	

> **FBA入仓归属于履约域**（序号19），这是原始设计，保持不变。	

### 5.2 跨域影响	

> FBA入仓会**影响库存域数据**（FBA仓库存增加），但不改变其归属。	

### 5.3 实现方式	

1. **履约域**：记录FBA入仓事务事实（物流维度）	
2. **库存域**：通过日快照反映FBA库存变化（仓库类型维度）	
3. **关联分析**：通过 ShipmentID 实现跨域钻取	

---

## 6. 类似的跨域业务过程	

| 业务过程 | 官方归属域 | 影响的其他域 | 关联方式 |
|----------|-----------|-------------|----------|
| FBA入仓 | 履约域 | 库存域（库存增加） | ShipmentID |
| 发货配送 | 履约域 | 库存域（库存减少） | 物流单号 |
| 处理退货 | 履约域 | 库存域（库存增加）、交易域（退款） | 退货单号 |
| 订单支付 | 交易域 | 履约域（触发发货） | 订单号 |

---

## 更新记录	

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v1.0 | 2026-01-19 | 初始版本，澄清FBA入仓的归属与跨域影响 |
